  <h1>ãƒ¡ãƒ‹ãƒ¥ãƒ¼è©³ç´°</h1>
  <% if user_signed_in? && @favorite.present? %>
    <%= link_to 'ãŠæ°—ã«å…¥ã‚Šè§£é™¤ã™ã‚‹', favorite_path(id: @favorite.id), method: :delete, class: 'btn btn-danger favorite-button', data: {menu_id: @menu.id, method: 'DELETE'} %>
  <% elsif user_signed_in? %>
    <%= link_to 'ãŠæ°—ã«å…¥ã‚Šã™ã‚‹', favorites_path(menu_id: @menu.id), method: :post, class: 'btn btn-primary favorite-button', data: { menu_id: @menu.id, method: 'POST'} %>
  <% end %>

<p>ã‚¿ã‚¤ãƒˆãƒ«: <%= @menu.title %></p>
<p>èª¬æ˜: <%= @menu.description %></p>
<p>ä½œæˆæ—¥æ™‚: <%= @menu.created_at.strftime('%Y-%m-%d %H:%M:%S') %></p>
<% if @menu.video.attached? %>
  <p>Video: </p>
  <video width="640" height="480" controls>
    <source src="<%= url_for(@menu.video) %>" type="video/mp4">
  </video>
<% else %>
  <p>No video attached</p>
<% end %>
<p>Difficulty Level: <%= @menu.difficulty_level.step %></p>

<%= form_with id: 'calculate-form' do |f| %>
  <%= f.label :practice_duration, 'ç·´ç¿’æ™‚é–“ï¼ˆåˆ†ï¼‰' %>
  <%= f.number_field :practice_duration, name: 'practice_duration' %>
  <br>
  <%= f.label :player_count_form, 'äººæ•°' %>
  <%= f.number_field :player_count_form, name: 'player_count' %>
  <br>
  <%= f.label :court_count, 'ã‚³ãƒ¼ãƒˆæ•°' %>
  <%= f.number_field :court_count, name: 'court_count' %>
  <br>
  <%= f.label :set_count, 'ã‚»ãƒƒãƒˆæ•°' %>
  <%= f.number_field :set_count, name: 'set_count' %>
  <br>
  <%= f.button 'è¨ˆç®—', type: 'button', id: 'calculate-button' %>
<% end %>

<p id="result"></p>

<%= image_tag("ãƒ†ãƒ‹ã‚¹ã‚³ãƒ¼ãƒˆ.jpeg", id: "court", alt: "Tennis Court") %>
<div id="court-container">
  <canvas id="canvas" width="400" height="200"></canvas>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelector('#calculate-button').addEventListener('click', function() {
        const practice_duration = parseFloat(document.querySelector('input[name="practice_duration"]').value);
        const player_count = parseFloat(document.querySelector('input[name="player_count"]').value);
        const court_count = parseFloat(document.querySelector('input[name="court_count"]').value);
        const set_count = parseFloat(document.querySelector('input[name="set_count"]').value);

        const result = practice_duration / player_count / court_count / set_count;
        const playerPerCourt = Math.floor(player_count / court_count);
        const extraPlayer = player_count % court_count;

        document.querySelector('#result').textContent = '1å›ã‚ãŸã‚Šã®äº¤ä»£æ™‚é–“ã¯' + result + 'åˆ†ã§ã™ã€‚' + '1ã‚³ãƒ¼ãƒˆã‚ãŸã‚Šã®äººæ•°ã¯' + playerPerCourt + 'äººã§ã™ã€‚' + (extraPlayer > 0 ? extraPlayer + 'é¢ã¯' + (playerPerCourt + 1) + 'äººã§ã™ã€‚' : '');

        const courtContainer = document.getElementById('court-container');
        courtContainer.innerHTML = '';

        for (let i = 0; i < court_count; i++) {
            const canvas = document.createElement('canvas');
            canvas.id = 'canvas-' + i;
            canvas.className = 'canvas';
            canvas.width = 400;
            canvas.height = 200;
            courtContainer.appendChild(canvas);
            
            const ctx = canvas.getContext('2d');

            const count = i < extraPlayer ? playerPerCourt + 1 : playerPerCourt;
            const courtWidth = canvas.width;
            const courtHeight = canvas.height;

            const playersPerRow = Math.ceil(Math.sqrt(count));  // players in a single row or column
            const cellWidth = courtWidth / playersPerRow;
            const cellHeight = courtHeight / playersPerRow;

            for (let j = 0; j < count; j++) {
                const x = (j % playersPerRow + 0.5) * cellWidth;
                const y = (Math.floor(j / playersPerRow) + 0.5) * cellHeight;

                ctx.font = '20px serif';
                ctx.fillText(`ğŸ‘¦${j + 1}`, x, y);
            }
        }
    });
});


$(document).on('click', '.favorite-button', function(e) {
    e.preventDefault();
    const button = $(this);
    const menuId = button.data('menu-id');
    const url = button.attr('href');
    const method = button.data('method') || 'POST'; // ãƒ¡ã‚½ãƒƒãƒ‰ã‚’dataå±æ€§ã‹ã‚‰å–å¾—
  
    $.ajax({
      url: url,
      method: method,
      dataType: 'json',
    })
    .done(function(data) {
      if (data.status === 'favorited') {
        button.text('ãŠæ°—ã«å…¥ã‚Šè§£é™¤ã™ã‚‹').removeClass('btn-primary').addClass('btn-danger');
      } else {
        button.text('ãŠæ°—ã«å…¥ã‚Šã™ã‚‹').removeClass('btn-danger').addClass('btn-primary');
      }
    })
    .fail(function() {
      alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    });
  });
</script>









<%# <label for="player_count_canvas">äººæ•°:</label>
<select id="player_count_canvas">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
</select>

<%= image_tag("ãƒ†ãƒ‹ã‚¹ã‚³ãƒ¼ãƒˆ.jpeg", id: "court", alt: "Tennis Court") %>
<%# <canvas id="canvas" width="400" height="200"></canvas> %>


<%# <%= javascript_pack_tag 'menu/show' %> 


